---
title: "Metabolomics x ML: Figure 4"
author: Mark Maher Makram Ebeid-Attalla
date: 2025-08-07
output: html_document
---

# Load libraries
```{r}

library(ggpubr)
library(ggplot2)
library(dplyr)
library(gridExtra)
library(tidyr)
library(tidyverse)
library(ggthemes)   # For additional themes
library(ggalluvial) # For Sankey diagrams
library(showtext)
library(readxl)
library(ggradar)
library(scales)      # muted() etc.
library(purrr)       # map() for functional loops
library(readxl)
library(tidyverse)
library(ggalluvial)
library(scales)      # wrap_format()

```
# Generate hardcoded plots for Figure 3
```{r}

# ── 1. Load and clean citation data

# Load citation data
citation_path <- "metabolites-review/data/citations-per-year.xlsx"
cites_raw <- read_excel(citation_path, sheet = 1)

# Clean and rename columns
citations <- cites_raw %>%
  rename(
    Title     = 1,
    Authors   = 2,
    Year      = 3,
    TotalCites= 4,
    CitPerYr  = 5,
    Objective = 6
  ) %>%
  mutate(
    Objective = str_trim(Objective),
    Objective = as.factor(Objective),
    CitPerYr  = as.numeric(CitPerYr)
  ) %>%
  filter(!is.na(CitPerYr), !is.na(Objective))

# Order objectives by mean CitPerYr
obj_order <- citations %>%
  group_by(Objective) %>%
  summarise(AvgCites = mean(CitPerYr), .groups = "drop") %>%
  arrange(desc(AvgCites)) %>%
  pull(Objective)

citations <- citations %>%
  mutate(Objective = factor(Objective, levels = obj_order))

```
```{r}

# ── 2.  Violin + jittered points for citation impact

p_cites <- ggplot(citations, aes(x = Objective, y = CitPerYr)) +

  geom_violin(fill = "lightblue", alpha = 0.4, color = "grey40", scale = "width") +
  geom_jitter(width = 0.2, size = 2, aes(color = Objective), show.legend = FALSE) +
  stat_summary(fun = mean, geom = "point", shape = 21, size = 3,
               fill = "black", color = "white", stroke = 1) +

  labs(
    title = "Citation Impact by Research Objective",
    x = NULL,
    y = "Citations per year (as of August 2025)"
  ) +

  theme_minimal(base_family = "Helvetica", base_size = 11) +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5, size = 13),
    axis.text.x = element_text(angle = 35, hjust = 1),
    panel.grid.major.x = element_blank(),
    plot.margin = margin(10, 15, 10, 15)
  )

print(p_cites)

```
```{r}

# ── 3.  Export vector graphics

ggsave(
  filename = "metabolites-review/figures/Figure_F_Citations_Per_Year.pdf",
  plot     = p_cites,
  width    = 26,
  height   = 14,
  units    = "cm",
  device   = cairo_pdf
)
```